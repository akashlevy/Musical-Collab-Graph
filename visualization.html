<!DOCTYPE html>
<!-- Adapted from http://bl.ocks.org/mbostock/ad70335eeef6d167bc36fd3c04378048 -->

<meta charset="utf-8">
<canvas width="960" height="600"></canvas>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
	// Select DOM elements and properties to draw graph within
	var canvas = document.querySelector("canvas"),
	context = canvas.getContext("2d"),
	width = canvas.width,
	height = canvas.height;
	
	// Create force simulation model
	var simulation = d3.forceSimulation()
		// Link force applied between source and target of each link
		.force("link", 
			d3.forceLink()
			.id(function(d, i) { return i; }) // Use numeric node ids
			.strength(function(link) {return 1 / link.freq}) // Stronger force for stronger links
			.distance(100) // Default separation
			)
		// Columb charge model, push nodes away from each other
		.force("charge", d3.forceManyBody())
		// Centering force, keeping center of mass at specified x,y coordinates
		.force("center", d3.forceCenter(width / 2, height / 2));
	
	// Fetch 
	d3.json("https://raw.githubusercontent.com/akashlevy/Musical-Collab-Graph/master/graph.json?token=AKKh4iV_Tbap0NmV6OaV_KTbi3PHY4Tlks5YYIX4wA%3D%3D", 
		function(error, graph) {
			if (error) throw error;
			
			simulation
				.nodes(graph.nodes)
				.on("tick", ticked);
			
			simulation.force("link")
				.links(graph.links);
			
			d3.select(canvas)
				.call(d3.drag()
					.container(canvas)
					.subject(dragsubject)
					.on("start", dragstarted)
					.on("drag", dragged)
					.on("end", dragended));
			
			function ticked() {
				context.clearRect(0, 0, width, height);
				
				context.beginPath();
				graph.links.forEach(drawLink);
				context.strokeStyle = "#aaa";
				context.stroke();
				
				context.beginPath();
				graph.nodes.forEach(drawNode);
				context.fill();
				context.strokeStyle = "#fff";
				context.stroke();
			}
			
			function dragsubject() {
				return simulation.find(d3.event.x, d3.event.y);
			}
	});
	
	function dragstarted() {
		if (!d3.event.active) simulation.alphaTarget(0.3).restart();
		d3.event.subject.fx = d3.event.subject.x;
		d3.event.subject.fy = d3.event.subject.y;
	}
	
	function dragged() {
		d3.event.subject.fx = d3.event.x;
		d3.event.subject.fy = d3.event.y;
	}
	
	function dragended() {
		if (!d3.event.active) simulation.alphaTarget(0);
		d3.event.subject.fx = null;
		d3.event.subject.fy = null;
	}
	
	function drawLink(d) {
		context.moveTo(d.source.x, d.source.y);
		context.lineTo(d.target.x, d.target.y);
	}
	
	function drawNode(d) {
		context.moveTo(d.x + 3, d.y);
		context.arc(d.x, d.y, 3, 0, 2 * Math.PI);
	}
</script>